<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.supringboot.mybatis.mapper.WishMapper">
	<!-- 공구식품 찜하기 -->
	<insert id="likedItem" parameterType="int">
		INSERT INTO liked (liked_id, user_id, item_id)
		VALUES (LIKE_SEQ.NEXTVAL, #{user_id}, #{item_id})
	</insert>
	
	<!-- 공구식품 찜하기 취소 -->
	<insert id="cancelLikedItem" parameterType="int">
		DELETE FROM liked
		WHERE user_id=#{user_id} AND item_id=#{item_id}
	</insert>

	<resultMap id="itemResult" type="Item">
		<id column="item_id" jdbcType="NUMERIC" property="item_id" />
		<result column="title" jdbcType="VARCHAR" property="title" />
		<result column="end_dt" jdbcType="NUMERIC" property="end_dt" />
		<result column="item_price" jdbcType="NUMERIC"
			property="item_price" />
		<result column="ship_price" jdbcType="NUMERIC"
			property="ship_price" />
		<result column="item_status" jdbcType="VARCHAR"
			property="item_status" />
		<collection property="images" ofType="Image">
			<id property="image_id" column="image_id" />
			<result property="image" column="image" />
		</collection>
	</resultMap>
	
	<!-- 찜한 공구식품 목록 가져오기 -->
	<select id="getWishItem" parameterType="int" resultMap="itemResult">
		SELECT i.item_id, title, end_dt, item_price, ship_price, item_status, im.image_id, im.image
		FROM item i, image im, liked l
		WHERE i.item_id=l.item_id AND i.item_id=im.item_id AND l.user_id=#{user_id}
	</select>

</mapper>
